<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../local-stream/local-stream.html">
<link rel="import" href="../ui-video-stream/audio-control.html">
<link rel="import" href="../ui-video-stream/video-control.html">
<link rel="import" href="../ui-video-call/ui-video-call.html">
<link rel="import" href="../ui-toolbar/ui-toolbar.html">
<link rel="import" href="../ui-sidebar/ui-sidebar.html">
<link rel="import" href="../ui-input/ui-input.html">
<link rel="import" href="../ui-hide/ui-hide.html">
<link rel="import" href="../chat-box/build/chat-box.html">
<link rel="stylesheet" type="text/css" href="./conference-room.css">

<polymer-element name="conference-room" attributes="room localstream calls nametag audioon videoon serverconfig root signallingServer focused">
<template>
  <video-control stream="{{localstream}}"></video-control>
  <audio-control stream="{{localstream}}"></audio-control>
  <local-stream id="local" audio video stream="{{localstream}}"></local-stream>

  <section id="chromeonly" class="ui notices">
    <div class="ui notice icon signin message">
      <i class="ui icon fa fa-hand-o-right fa-4x"></i>
      <div class="content">
        <div class="header">Need Some Chrome</div>
        <p>Sorry -- this version only runs in Chrome browsers</p>
      </div>
    </div>
  </section>

  <ui-mainbar>

  <ui-toolbar>
  <ui-toggle-tool icon="fa-eye" togglechanged="selfie" tooltip="Video selfie (s)" hotkey="s"></ui-toggle-tool>
  <ui-toggle-tool icon="fa-video-camera" togglechanged="video" active="{{videoon}}" tooltip="Video mute (v)" hotkey="v"></ui-toggle-tool>
  <ui-toggle-tool icon="fa-microphone" togglechanged="audio" active="{{audioon}}" tooltip="Audio mute (spacebar)" hotkey="32"></ui-toggle-tool>
  <ui-toggle-tool icon="fa-comments" togglechanged="chatbar" tooltip="Text chat (enter)" hotkey="13">
  <div class="ui label red count-{{chatCount}}">{{chatCount}}</div>
  </ui-toggle-tool>
  <ui-toolbar-pad></ui-toolbar-pad>
  <section class="ui form inverted">
    <div class="ui field">
      <div class="ui input">
        <input id="miniRoomSelector" type="text" value="{{roomLabel}}" on-keyup="{{roomSelectorKeypressed}}" placeholder="Enter a workroom name" />
      </div>
    </div>
  </section>
  </ui-toolbar>


  <section class="ui container room-selector {{ { full: (!calls || calls.length === 0), mini: calls.length > 0 } | tokenList }}">
    <div class="ui inverted">
      <div class="content">
        <div class="ui large form">
          <div class="ui field">
            <div class="ui massive icon input">
              <input id="roomSelector" type="text" value="{{roomLabel}}" on-keyup="{{roomSelectorKeypressed}}" placeholder="Enter a workroom name to create/join" />
              <i class="circular green checkmark icon {{ { hidden: roomLabel.length < 2 } | tokenList }}"></i>
            </div>
          </div>
        </div>
        <template if="{{ !(roomLabel && roomLabel.length >= 2) }}">
          <p>
            Welcome to workrooms, choose a room to start collaborating.  If the room doesn't already exist, we'll create it for you so others can join you.
          </p>
        </template>
        <template if="{{roomLabel && roomLabel.length >= 2}}">
          <p>
            This room is currently empty, just waiting for others to show up.  You should probably share this url anyone you want to join.
          </p>
        </template>
      </div>
    </div>
  </section>


  <section class="calls">
    <ui-video-stream id="selfie" class="ui tile video" stream="{{localstream}}" selfie mirror></ui-video-stream>
    <template id="calls" repeat="{{call in calls}}">
      <ui-video-call class="ui tile video" id="A{{call.id}}" call="{{call}}"
      localstream="{{localstream}}" localaudio="{{audioon}}" localvideo="{{videoon}}"
      remotestream="{{call.remotestream}}" remoteaudio="{{call.remoteaudio}}" remotevideo="{{call.remotevideo}}"
      fromclientid="{{call.fromclientid}}" toclientid="{{call.toclientid}}">
      <ui-video-stream stream="{{call.remotestream}}" audio="{{call.remoteaudio}}" video="{{call.remotevideo}}"></ui-video-stream>
      </ui-video-call>
    </template>
  </section>


  </ui-mainbar>


  <ui-sidebar id="chatbar" class="ui floating right hide">
  <chat-box id="chat"></chat-box>
  </ui-sidebar>


</template>
<script src="./conference-room.js"></script>
</polymer-element>
