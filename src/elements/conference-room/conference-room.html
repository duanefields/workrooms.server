<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../local-stream/local-stream.html">
<link rel="import" href="../ui-video-stream/audio-control.html">
<link rel="import" href="../ui-video-stream/video-control.html">
<link rel="import" href="../ui-video-call/ui-video-call.html">
<link rel="import" href="../ui-toolbar/ui-toolbar.html">
<link rel="import" href="../ui-sidebar/ui-sidebar.html">
<link rel="import" href="../ui-input/ui-input.html">
<link rel="import" href="../ui-user-profile/ui-user-profile.html">
<link rel="import" href="../ui-user-profile/ui-user-profile-github-gravatar.html">
<link rel="import" href="../ui-hide/ui-hide.html">
<link rel="import" href="../chat-box/build/chat-box.html">
<link rel="stylesheet" type="text/css" href="./conference-room.css">

<polymer-element name="conference-room" attributes="localstream calls userprofiles audioon videoon serverconfig">
<template>
  <video-control stream="{{localstream}}"></video-control>
  <audio-control stream="{{localstream}}"></audio-control>
  <local-stream id="local" audio video stream="{{localstream}}"></local-stream>
  <ui-sidebar id="sidebar" class="ui narrow floating left">
  <span class="grid grid--gutters">
    <ui-input class="grid-cell" icon="fa-search" placeholder="Search..."></ui-input>
  </span>
  <span class="grid grid--gutters">
    <ul class="ui list grid-cell">
      <template id="searchresults" repeat="{{profile in profiles}}">
        <li class="profile">
          <ui-user-profile class="grid-cell" profile="{{profile}}"></ui-user-profile>
        </li>
      </template>
    </ul>
  </span>
  </ui-sidebar>
  <ui-mainbar>
  <ui-toolbar>
  <ui-command-tool icon="fa-bars" command="sidebar" tooltip="Search in the sidebar"></ui-command-tool>
  <ui-command-tool icon="fa-comments" command="chatbar" tooltip="Text chat"></ui-command-tool>
  <ui-toggle-tool icon="fa-eye" togglechanged="selfie" tooltip="Video selfie"></ui-toggle-tool>
  <ui-toggle-tool icon="fa-video-camera" togglechanged="video" active="{{videoon}}" tooltip="Video mute"></ui-toggle-tool>
  <ui-toggle-tool icon="fa-microphone" togglechanged="audio" active="{{audioon}}" tooltip="Audio mute"></ui-toggle-tool>
  <ui-command-tool icon="fa-phone fa-rotate-135" command="hangup" tooltip="Hang up all calls"></ui-command-tool>
  <ui-hide class="ui right" show="{{userprofiles.github}}">
  <ui-user-profile-github-gravatar github="{{userprofiles.github}}">
  </ui-user-profile-github-gravatar>
  <ui-command-tool icon="fa-sign-out" href="/auth/logout" tooltip="Sign out"></ui-command-tool>
  </ui-hide>
  <ui-hide class="ui right" hide="{{userprofiles.github}}">
  <ui-command-tool icon="fa-github" href="/auth/github" tooltip="Sign in via Github"></ui-command-tool>
  </ui-hide>
  </ui-toolbar>
  <span class="calls">
    <div id="selfie" class="ui tile video">
      <section>
        <ui-video-stream stream="{{localstream}}" mutedaudio mirror></ui-video-stream>
        <ui-toolbar>
        <ui-user-profile-github-gravatar github="{{userprofiles.github}}">
        </ui-user-profile-github-gravatar>
        </ui-toolbar>
      </section>
    </div>
    <template id="calls" repeat="{{call in calls}}">
      <ui-video-call id="A{{call.id}}" outbound?="{{call.outbound}}" inbound?="{{call.inbound}}" callid="{{call.callid}}" 
      localstream="{{localstream}}" localaudio="{{audioon}}" localvideo="{{videoon}}" 
      remotestream="{{call.remotestream}}" remoteaudio="{{call.remoteaudio}}" remotevideo="{{call.remotevideo}}" config="{{call.config}}">
      <div class="ui tile video">
        <section>
          <ui-video-stream stream="{{call.remotestream}}" audio="{{call.remoteaudio}}" video="{{call.remotevideo}}"></ui-video-stream>
          <ui-toolbar>
          <ui-user-profile-github-gravatar github="{{call.userprofiles.github}}">
          </ui-user-profile-github-gravatar>
        </section>
      </div>
      </ui-video-call>
    </template>
  </span>
  </ui-mainbar>
  <ui-sidebar id="chatbar" class="ui floating right">
  <chat-box id="chat"></chat-box>
  </ui-sidebar>
</template>
<script src="./conference-room.js"></script>
</polymer-element>
